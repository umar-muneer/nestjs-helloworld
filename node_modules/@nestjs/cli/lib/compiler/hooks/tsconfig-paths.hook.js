"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const pathToRegexp = require("path-to-regexp");
function tsconfigPathsBeforeHookFactory(compilerOptions) {
    const { paths = {}, baseUrl } = compilerOptions;
    const pathsToInspect = Object.keys(paths).map(path => ({
        matcher: pathToRegexp(path),
        originalPath: path,
    }));
    return (ctx) => {
        const head = (arr) => arr && arr[0];
        return (sf) => {
            const imports = sf.imports || [];
            imports.forEach(item => {
                const result = pathsToInspect.find(({ matcher }) => matcher.test(item.text));
                if (!result) {
                    return;
                }
                const resolvedPath = path_1.relative(path_1.dirname(sf.fileName), path_1.join(baseUrl, head(paths[result.originalPath]))) || './';
                item.text = item.text.replace(result.matcher, resolvedPath);
            });
            return sf;
        };
    };
}
exports.tsconfigPathsBeforeHookFactory = tsconfigPathsBeforeHookFactory;
